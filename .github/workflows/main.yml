name: Build and Deploy to Github Pages

on:
  push:
    branches:
    - main
permissions:
  contents: read

jobs:
  build_and_deploy:
    if: github.repository == 'buildfarm/buildfarm'
    runs-on: ubuntu-latest
    permissions:
      pages: write
    steps:
    - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd   # v6.0.2

      # Use GitHub Actions' cache to cache dependencies on servers
    - uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306   # v5.0.3
      with:
        path: vendor/bundle
        key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-gems-

      # Use GitHub Deploy Action to build and deploy to Github
    - uses: jeffreytse/jekyll-deploy-action@222a6b06c846416d654db18142eab0da528cdb4f   # v0.7.0
      with:
        provider: github
        token: ${{ secrets.GH_TOKEN }}   # It's your Personal Access Token(PAT)
        repository: ''               # Default is current repository
        branch: gh-pages             # Default is gh-pages for github provider
        jekyll_src: _site            # Default is root directory
        jekyll_cfg: _config.yml      # Default is _config.yml
        jekyll_baseurl: ''           # Default is according to _config.yml
        bundler_ver: '>=0'           # Default is latest bundler version
        cname: ''                    # Default is to not use a cname
        actor: ''                    # Default is the GITHUB_ACTOR
        pre_build_commands: ''       # Installing additional dependencies (Arch Linux)
