<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/buildfarm/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/buildfarm/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/buildfarm/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/buildfarm/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Configuration | Buildfarm</title><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Configuration" /><meta property="og:locale" content="en_US" /><meta name="description" content="Remote Caching and Execution" /><meta property="og:description" content="Remote Caching and Execution" /><link rel="canonical" href="https://buildfarm.github.io/buildfarm/docs/configuration/configuration/" /><meta property="og:url" content="https://buildfarm.github.io/buildfarm/docs/configuration/configuration/" /><meta property="og:site_name" content="Buildfarm" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Configuration" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Remote Caching and Execution","headline":"Configuration","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://buildfarm.github.io/buildfarm/assets/images/buildfarm-logo.png"}},"url":"https://buildfarm.github.io/buildfarm/docs/configuration/configuration/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://buildfarm.github.io/buildfarm/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/features/" class="nav-list-link">Features</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/quick_start/" class="nav-list-link">Quick Start</a><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/configuration/configuration/" class="nav-list-link active">Configuration</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/configuration/authentication/" class="nav-list-link">Authentication</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/architecture/architecture/" class="nav-list-link">Architecture</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/instance_types/" class="nav-list-link">Instance Types</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/workers/" class="nav-list-link">Workers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/schedulers/" class="nav-list-link">Schedulers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/worker-execution-environment/" class="nav-list-link">Worker Execution Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/queues/" class="nav-list-link">Queues</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/action_cache/" class="nav-list-link">Action Cache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/CASFileCache/" class="nav-list-link">CASFileCache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/content_addressable_storage/" class="nav-list-link">CAS</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/redis/" class="nav-list-link">Redis</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution/" class="nav-list-link">Execution</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/" class="nav-list-link">Debugging</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/environment/" class="nav-list-link">Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/exec_owner/" class="nav-list-link">Owner</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_limiting/" class="nav-list-link">Limiting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/builds-without-the-bytes/" class="nav-list-link">Build Without Bytes</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_properties/" class="nav-list-link">Properties</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_policies/" class="nav-list-link">Policies</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/observability/" class="nav-list-link">Observability</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/metrics/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/metrics/alerts/" class="nav-list-link">Alerts</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/tools/tools/" class="nav-list-link">Tools</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/troubleshooting-bazel-remote-execution/" class="nav-list-link">Troubleshooting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/bf-cat/" class="nav-list-link">bf-cat</a></ul><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/admin/" class="nav-list-link">Admin</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/contribute/contribute/" class="nav-list-link">Contribute</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/local_development/" class="nav-list-link">Local Development</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/design-documents/" class="nav-list-link">Design Documents</a></ul></ul></nav><footer class="site-footer"></footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Buildfarm" aria-label="Search Buildfarm" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/buildfarm/buildfarm" class="site-button" > GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><p>Minimal required:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backplane</span><span class="pi">:</span>
  <span class="na">redisUri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://localhost:6379"</span>
  <span class="na">queues</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cpu"</span>
      <span class="na">properties</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">min-cores"</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">max-cores"</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
<span class="na">worker</span><span class="pi">:</span>
  <span class="na">publicName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">localhost:8981"</span>
</code></pre></div></div><p>Configuration files also support includes via !include tag:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backplane</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s2">"</span><span class="s">backplane.yml"</span>
<span class="na">server</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s2">"</span><span class="s">server.yml"</span>
<span class="na">worker</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s2">"</span><span class="s">worker.yml"</span>
</code></pre></div></div><p>The configuration can be provided to the server and worker as a CLI argument or through the environment variable <code class="language-plaintext highlighter-rouge">CONFIG_PATH</code> For an example configuration containing all of the configuration values, see <code class="language-plaintext highlighter-rouge">examples/config.yml</code>.</p><h2 id="all-configurations"> <a href="#all-configurations" class="anchor-heading" aria-labelledby="all-configurations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> All Configurations</h2><h3 id="common"> <a href="#common" class="anchor-heading" aria-labelledby="common"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Command Line Argument<th>Description<tbody><tr><td>digestFunction<td><em>SHA256</em>, SHA1<td> <td>Digest function for this implementation<tr><td>defaultActionTimeout<td>Integer, <em>600</em><td> <td>Default timeout value for an action (seconds)<tr><td>maximumActionTimeout<td>Integer, <em>3600</em><td> <td>Maximum allowed action timeout (seconds)<tr><td>maxEntrySizeBytes<td>Long, <em>2147483648</em><td> <td>Maximum size of a single blob accepted (bytes)<tr><td>prometheusPort<td>Integer, <em>9090</em><td>–prometheus_port<td>Listening port of the Prometheus metrics endpoint<tr><td>allowSymlinkTargetAbsolute<td>boolean, <em>false</em><td> <td>Permit inputs to contain symlinks with absolute path targets</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">digestFunction</span><span class="pi">:</span> <span class="s">SHA1</span>
<span class="na">defaultActionTimeout</span><span class="pi">:</span> <span class="m">1800</span>
<span class="na">maximumActionTimeout</span><span class="pi">:</span> <span class="m">1800</span>
<span class="na">prometheusPort</span><span class="pi">:</span> <span class="m">9090</span>
<span class="na">server</span><span class="pi">:</span>
  <span class="s">...</span>
<span class="na">worker</span><span class="pi">:</span>
  <span class="s">...</span>
</code></pre></div></div><h3 id="server"> <a href="#server" class="anchor-heading" aria-labelledby="server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Environment Var<th>Description<tbody><tr><td>instanceType<td><em>SHARD</em><td> <td>Type of implementation (SHARD is the only one supported)<tr><td>name<td>String, <em>shard</em><td> <td>Implementation name<tr><td>publicName<td>String, <em>DERIVED:port</em><td>INSTANCE_NAME<td>Host:port of the GRPC server, required to be accessible by all servers<tr><td>actionCacheReadOnly<td>boolean, <em>false</em><td> <td>Allow/Deny writing to action cache<tr><td>port<td>Integer, <em>8980</em><td> <td>Listening port of the GRPC server<tr><td>bindAddress<td>String<td> <td>Listening address of the GRPC server, default for Java Grpc (all interface addresses) if unspecified<tr><td>maxInboundMessageSizeBytes<td>Integer, <em>0</em><td> <td>Byte size limit of GRPC messages, default for Java Grpc if unspecified or 0<tr><td>maxInboundMetadataSize<td>Integer, <em>0</em><td> <td>Byte size limit of GRPC metadata, default for Java Grpc if unspecified or 0<tr><td>casWriteTimeout<td>Integer, <em>3600</em><td> <td>CAS write timeout (seconds)<tr><td>bytestreamTimeout<td>Integer, <em>3600</em><td> <td>Byte Stream write timeout (seconds)<tr><td>sslCertificatePath<td>String, <em>null</em><td> <td>Absolute path of the SSL certificate (if TLS used)<tr><td>sslPrivateKeyPath<td>String, <em>null</em><td> <td>Absolute path of the SSL private key (if TLS used)<tr><td>runDispatchedMonitor<td>boolean, <em>true</em><td> <td>Enable an agent to monitor the operation store to ensure that dispatched operations with expired worker leases are requeued<tr><td>dispatchedMonitorIntervalSeconds<td>Integer, <em>1</em><td> <td>Dispatched monitor’s lease expiration check interval (seconds)<tr><td>runOperationQueuer<td>boolean, <em>true</em><td> <td>Acquire execute request entries cooperatively from an arrival queue on the backplane<tr><td>ensureOutputsPresent<td>boolean, <em>true</em><td> <td>Ensure ActionResult outputs are present in the CAS on ActionCache::GetActionResults. If any outputs are missing a cache miss is returned<tr><td>maxCpu<td>Integer, <em>0</em><td> <td>Maximum number of CPU cores that any min/max-cores property may request (0 = unlimited)<tr><td>maxRequeueAttempts<td>Integer, <em>5</em><td> <td>Maximum number of requeue attempts for an operation<tr><td>useDenyList<td>boolean, <em>true</em><td> <td>Allow usage of a deny list when looking up actions and invocations (for cache only it is recommended to disable this check)<tr><td>mergeExecutions<td>boolean, <em>true</em><td> <td>Merge executions with matching action_digest by default (overridable with MERGE_EXECUTIONS correlatedInvocationsId URL param)<tr><td>grpcTimeout<td>Integer, <em>3600</em><td> <td>GRPC request timeout (seconds)<tr><td>executeKeepaliveAfterSeconds<td>Integer, <em>60</em><td> <td>Execute keep alive (seconds)<tr><td>recordBesEvents<td>boolean, <em>false</em><td> <td>Allow recording of BES events<tr><td>clusterId<td>String, <em>local</em><td> <td>Buildfarm cluster ID<tr><td>cloudRegion<td>String, <em>us-east_1</em><td> <td>Deployment region in the cloud<tr><td>gracefulShutdownSeconds<td>Integer, 0<td> <td>Time in seconds to allow for connections in flight to finish when shutdown signal is received</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">instanceType</span><span class="pi">:</span> <span class="s">SHARD</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">shard</span>
  <span class="na">actionCacheReadOnly</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">recordBesEvents</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div><h3 id="grpc-metrics"> <a href="#grpc-metrics" class="anchor-heading" aria-labelledby="grpc-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GRPC Metrics</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>enabled<td>boolean, <em>false</em><td>Publish basic GRPC metrics to a Prometheus endpoint<tr><td>provideLatencyHistograms<td>boolean, <em>false</em><td>Publish detailed, more expensive to calculate, metrics<tr><td>labelsToReport<td>List of Strings, <em>[]</em><td>Include custom metrics labels in Prometheus metrics</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">grpcMetrics</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">provideLatencyHistograms</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">labelsToReport</span><span class="pi">:</span> <span class="pi">[]</span>
</code></pre></div></div><h3 id="server-caches"> <a href="#server-caches" class="anchor-heading" aria-labelledby="server-caches"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server Caches</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>directoryCacheMaxEntries<td>Long, <em>64 * 1024</em><td>The max number of entries that the directory cache will hold.<tr><td>commandCacheMaxEntries<td>Long, <em>64 * 1024</em><td>The max number of entries that the command cache will hold.<tr><td>digestToActionCacheMaxEntries<td>Long, <em>64 * 1024</em><td>The max number of entries that the digest-to-action cache will hold.<tr><td>recentServedExecutionsCacheMaxEntries<td>Long, <em>64 * 1024</em><td>The max number of entries that the executions cache will hold.</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">caches</span><span class="pi">:</span>
    <span class="na">directoryCacheMaxEntries</span><span class="pi">:</span> <span class="m">10000</span>
    <span class="na">commandCacheMaxEntries</span><span class="pi">:</span> <span class="m">10000</span>
    <span class="na">digestToActionCacheMaxEntries</span><span class="pi">:</span> <span class="m">10000</span>
    <span class="na">recentServedExecutionsCacheMaxEntries</span><span class="pi">:</span> <span class="m">10000</span>
</code></pre></div></div><h3 id="admin"> <a href="#admin" class="anchor-heading" aria-labelledby="admin"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Admin</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>deploymentEnvironment<td>String, AWS, GCP<td>Specify deloyment environment in the cloud<tr><td>clusterEndpoint<td>String, grpc://localhost<td>Buildfarm cluster endpoint for Admin use (this is a full buildfarm endpoint)</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">admin</span><span class="pi">:</span>
    <span class="na">deploymentEnvironment</span><span class="pi">:</span> <span class="s">AWS</span>
    <span class="na">clusterEndpoint</span><span class="pi">:</span> <span class="s2">"</span><span class="s">grpc://localhost"</span>
</code></pre></div></div><h3 id="metrics"> <a href="#metrics" class="anchor-heading" aria-labelledby="metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metrics</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>publisher<td>String, aws, gcp, <em>log</em><td>Specify publisher type for sending metadata<tr><td>logLevel<td>String, INFO, <em>FINEST</em><td>Specify log level (“log” publisher only, all Java util logging levels are allowed here)<tr><td>topic<td>String, <em>test</em><td>Specify SNS topic name for cloud publishing (“aws” publisher only)<tr><td>topicMaxConnections<td>Integer, 1000<td>Specify maximum number of connections allowed for cloud publishing (“aws” publisher only)<tr><td>secretName<td>String, <em>test</em><td>Specify secret name to pull SNS permissions from (“aws” publisher only)</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">metrics</span><span class="pi">:</span>
    <span class="na">publisher</span><span class="pi">:</span> <span class="s">log</span>
    <span class="na">logLevel</span><span class="pi">:</span> <span class="s">INFO</span>
</code></pre></div></div><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">metrics</span><span class="pi">:</span>
    <span class="na">publisher</span><span class="pi">:</span> <span class="s">aws</span>
    <span class="na">topic</span><span class="pi">:</span> <span class="s">buildfarm-metadata-test</span>
    <span class="na">topicMaxConnections</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">secretName</span><span class="pi">:</span> <span class="s">buildfarm-secret</span>
</code></pre></div></div><h3 id="correlated-invocations-index-scopes"> <a href="#correlated-invocations-index-scopes" class="anchor-heading" aria-labelledby="correlated-invocations-index-scopes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Correlated Invocations Index Scopes</h3><p>A set of names to extract per-correlatedInvocationsId fields from a valid URI to create indices which will contain the fragment uuid</p><div class="table-wrapper"><table><thead><tr><th>Entry<th>URI Component<tbody><tr><td>host<td>authority:host<tr><td>username<td>userinfo:username<tr><td>* (<em>any key</em>)<td>query[key] (one index per specified pair)</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">correlatedInvocationsIndexScopes</span><span class="pi">:</span> <span class="kt">!!set</span>
    <span class="pi">?</span> <span class="s">host</span>
    <span class="pi">?</span> <span class="s">username</span>
</code></pre></div></div><h3 id="redis-backplane"> <a href="#redis-backplane" class="anchor-heading" aria-labelledby="redis-backplane"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis Backplane</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Environment Var<th>Command Line Argument<th>Description<tbody><tr><td>type<td><em>SHARD</em><td> <td> <td>Type of backplane. Currently, the only implementation is SHARD utilizing Redis<tr><td>redisUri<td>String, redis://localhost:6379<td>REDIS_URI<td>–redis_uri<td>Redis cluster endpoint. This must be a single URI. This can embed a username/password per RFC-3986 Section 3.2.1 and this will take precedence over <code class="language-plaintext highlighter-rouge">redisPassword</code> and <code class="language-plaintext highlighter-rouge">redisPasswordFile</code>.<tr><td>redisUsername<td>String, <em>null</em><td> <td> <td>Redis username, if applicable<tr><td>redisPassword<td>String, <em>null</em><td> <td> <td>Redis password, if applicable<tr><td>redisPasswordFile<td>String, <em>null</em><td> <td> <td>File to read for a Redis password. If specified, this takes precedence over <code class="language-plaintext highlighter-rouge">redisPassword</code><tr><td>redisNodes<td>List of Strings, <em>null</em><td> <td> <td>List of individual Redis nodes, if applicable<tr><td>redisCertificateAuthorityFile<td>String, <em>null</em><td> <td> <td>File to read for Redis connection SSL certificate authority. If specified, this is the exclusive certificate authority bundle for Redis connections. Must be a PEM file.<tr><td>redisAuthWithGoogleCredentials<td>boolean, <em>false</em><td> <td> <td>If true, use GOOGLE_DEFAULT_CREDENTIALS environment variable to find a service account to authenticate to Redis. useful for Google Memorystore Redis Cluster<tr><td>jedisPoolMaxTotal<td>Integer, <em>4000</em><td> <td> <td>The size of the Redis connection pool<tr><td>jedisPoolMaxIdle<td>Integer, <em>8</em><td> <td> <td>The maximum size of idle connection to Redis<tr><td>jedisPoolMinIdle<td>Integer, <em>0</em><td> <td> <td>The size of guaranteed idle connection to Redis<tr><td>jedisTimeBetweenEvictionRunsMillis<td>Long, <em>30000</em><td> <td> <td>The period for detecting idle connections to Redis. If you set -1, detection will be disabled.<tr><td>workersHashName<td>String, <em>Workers</em><td> <td> <td>Redis key used to store a hash of registered workers<tr><td>workerChannel<td>String, <em>WorkerChannel</em><td> <td> <td>Redis pubsub channel key where changes of the cluster membership are announced<tr><td>actionCachePrefix<td>String, <em>ActionCache</em><td> <td> <td>Redis key prefix for all ActionCache entries<tr><td>actionCacheExpire<td>Integer, <em>2419200</em><td> <td> <td>The TTL maintained for ActionCache entries, refreshed on getActionResult hit<tr><td>actionBlocklistPrefix<td>String, <em>ActionBlocklist</em><td> <td> <td>Redis key prefix for all blocklisted actions, which are rejected<tr><td>actionBlocklistExpire<td>Integer, <em>3600</em><td> <td> <td>The TTL maintained for action blocklist entries<tr><td>invocationBlocklistPrefix<td>String, <em>InvocationBlocklist</em><td> <td> <td>Redis key prefix for blocklisted invocations, suffixed with a a tool invocation ID<tr><td>operationPrefix<td>String, <em>Operation</em><td> <td> <td>Redis key prefix for all operations, suffixed with the operation’s name<tr><td>operationExpire<td>Integer, <em>604800</em><td> <td> <td>The TTL maintained for all executions, updated on each modification<tr><td>actionExecutionExpire<td>Integer, <em>21600</em><td> <td> <td>The TTL maintained for all action -&gt; execution mappings for mergeExecutions<tr><td>preQueuedOperationsListName<td>String, <em>{Arrival}:PreQueuedOperations</em><td> <td> <td>Redis key used to store a list of ExecuteEntry awaiting transformation into QueryEntry<tr><td>processingListName<td>String, <em>{Arrival}:ProcessingOperations</em><td> <td> <td>Redis key of a list used to ensure reliable processing of arrival queue entries with operation watch monitoring<tr><td>processingPrefix<td>String, <em>Processing</em><td> <td> <td>Redis key prefix for operations which are being dequeued from the arrival queue<tr><td>processingTimeoutMillis<td>Integer, <em>20000</em><td> <td> <td>Delay (in ms) used to populate processing operation entries<tr><td>queuedOperationsListName<td>String, <em>{Execution}:QueuedOperations</em><td> <td> <td>Redis key used to store a list of QueueEntry awaiting execution by workers<tr><td>dispatchingPrefix<td>String, <em>Dispatching</em><td> <td> <td>Redis key prefix for operations which are being dequeued from the ready to run queue<tr><td>dispatchingTimeoutMillis<td>Integer, <em>10000</em><td> <td> <td>Delay (in ms) used to populate dispatching operation entries<tr><td>dispatchedOperationsHashName<td>String, <em>DispatchedOperations</em><td> <td> <td>Redis key of a hash of operation names to the worker lease for its execution, which are monitored by the dispatched monitor<tr><td>operationChannelPrefix<td>String, <em>OperationChannel</em><td> <td> <td>Redis pubsub channel prefix suffixed by an operation name<tr><td>casPrefix<td>String, <em>ContentAddressableStorage</em><td> <td> <td>Redis key prefix suffixed with a blob digest that maps to a set of workers with that blob’s availability<tr><td>casExpire<td>Integer, <em>604800</em><td> <td> <td>The TTL maintained for CAS entries, which is refreshed on any read access of the blob<tr><td>subscribeToBackplane<td>boolean, <em>true</em><td> <td> <td>Enable an agent of the backplane client which subscribes to worker channel and operation channel events. If disabled, responsiveness of watchers and CAS are reduced<tr><td>runFailsafeOperation<td>boolean, <em>true</em><td> <td> <td>Enable an agent in the backplane client which monitors watched operations and ensures they are in a known maintained, or expirable state<tr><td>maxQueueDepth<td>Integer, <em>100000</em><td> <td> <td>Maximum length that the ready to run queue is allowed to reach to control an arrival flow for execution<tr><td>maxPreQueueDepth<td>Integer, <em>1000000</em><td> <td> <td>Maximum lengh that the arrival queue is allowed to reach to control load on the Redis cluster<tr><td>priorityQueue<td>boolean, <em>false</em><td> <td> <td>Priority queue type allows prioritizing operations based on Bazel’s –remote_execution_priority=<an integer=""> flag</an><tr><td>timeout<td>Integer, <em>10000</em><td> <td> <td>Default timeout<tr><td>maxInvocationIdTimeout<td>Integer, <em>604800</em><td> <td> <td>Maximum TTL (Time-to-Live in second) of invocationId keys in RedisBackplane<tr><td>maxAttempts<td>Integer, <em>20</em><td> <td> <td>Maximum number of execution attempts<tr><td>connectionValidatedOnBorrow<td>boolean, <em>false</em><td> <td> <td>Whether to validate Redis connections when borrowing from the pool</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backplane</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">SHARD</span>
  <span class="na">redisUri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://localhost:6379"</span>
  <span class="na">priorityQueue</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div><h3 id="execution-queues"> <a href="#execution-queues" class="anchor-heading" aria-labelledby="execution-queues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Execution Queues</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>name<td>String<td>Name of the execution queue (ex: cpu, gpu)<tr><td>allowUnmatched<td>boolean, <em>true</em><td> <tr><td>properties<td>List of name/value pairs<td>Any specification of min/max-cores will be allowed to support CPU controls and worker resource delegation</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backplane</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">SHARD</span>
  <span class="na">redisUri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://localhost:6379"</span>
  <span class="na">queues</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cpu"</span>
      <span class="na">allowUnmatched</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">properties</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">min-cores"</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">max-cores"</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
</code></pre></div></div><h3 id="worker"> <a href="#worker" class="anchor-heading" aria-labelledby="worker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Worker</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Environment Var<th>Description<tbody><tr><td>port<td>Integer, <em>8981</em><td> <td>Listening port of the worker<tr><td>publicName<td>String, <em>DERIVED:port</em><td>INSTANCE_NAME<td>Host:port of the GRPC server, required to be accessible by all servers<tr><td>root<td>String, <em>/tmp/worker</em><td> <td>Path for all operation content storage<tr><td>inlineContentLimit<td>Integer, <em>1048567</em><td> <td>Total size in bytes of inline content for action results, output files, stdout, stderr content<tr><td>operationPollPeriod<td>Integer, <em>1</em><td> <td>Period between poll operations at any stage<tr><td>executeStageWidth<td>Integer, <em>0</em><td>EXECUTION_STAGE_WIDTH<td>Number of CPU cores available for execution (0 = system available cores)<tr><td>executeStageWidthOffset<td>Integer, <em>0</em><td> <td>Offset number of CPU cores available for execution (to allow for use by other processes)<tr><td>inputFetchStageWidth<td>Integer, <em>0</em><td> <td>Number of concurrently available slots to fetch inputs (0 = system calculated based on CPU cores)<tr><td>inputFetchDeadline<td>Integer, <em>60</em><td> <td>Limit on time (seconds) for input fetch stage to fetch inputs<tr><td>reportResultStageWidth<td>Integer, <em>1</em><td> <td>Number of concurrently available slots to write results and clean up execution directories<tr><td>linkExecFileSystem<td>boolean, <em>true</em><td> <td>Use hard links instead of file copies to populate execution directories. Disable on Windows to compensate for shared hard-link deletion semantics for running executables.<tr><td>linkInputDirectories<td>boolean, <em>true</em><td> <td>Use an input directory creation strategy which creates a single directory tree at the highest level containing no output paths of any kind, and symlinks that directory into an action’s execroot, saving large amounts of time spent manufacturing the same read-only input hierirchy over multiple actions’ executions<tr><td>execOwner<td>String, <em>null</em><td> <td>Create exec trees containing directories that are owned by this user<tr><td>execOwners<td>List of Strings<td> <td>Create exec trees containing directories that are owned by these users, unique to each execution. Must contain at least the sum of {<code class="language-plaintext highlighter-rouge">inputFetchStageWidth</code>, <code class="language-plaintext highlighter-rouge">executeStageWidth</code>, <code class="language-plaintext highlighter-rouge">reportResultStageWidth</code>} owners. If this option is specified and not empty, <code class="language-plaintext highlighter-rouge">execOwner</code> is ignored<tr><td>hexBucketLevels<td>Integer, <em>0</em><td> <td>Number of levels to create for directory storage by leading byte of the hash<tr><td>defaultMaxCores<td>Integer, <em>0</em><td> <td>Constrain all executions to this logical core count unless otherwise specified via min/max-cores (0 = no limit)<tr><td>limitGlobalExecution<td>boolean, <em>false</em><td> <td>Constrain all executions to a pool of logical cores specified in executeStageWidth<tr><td>onlyMulticoreTests<td>boolean, <em>false</em><td> <td>Only permit tests to exceed the default coresvalue for their min/max-cores range specification (only works with non-zero defaultMaxCores)<tr><td>allowBringYourOwnContainer<td>boolean, <em>false</em><td> <td>Enable execution in a custom Docker container<tr><td>errorOperationRemainingResources<td>boolean, <em>false</em><td> <td> <tr><td>errorOperationOutputSizeExceeded<td>boolean, <em>false</em><td> <td>Operations which produce single output files which exceed maxEntrySizeBytes will fail with a violation type which implies a user error. When disabled, the violation will indicate a transient error, with the action blocklisted.<tr><td>linkedInputDirectories<td>List of Strings, <em>^(?!external$).*$</em><td> <td>A list of regular expressions matching input directories which will be subject to the effects of linkInputDirectories setting<tr><td>gracefulShutdownSeconds<td>Integer, 0<td> <td>Time in seconds to allow for operations in flight to finish when shutdown signal is received<tr><td>createSymlinkOutputs<td>boolean, <em>false</em><td> <td>Creates SymlinkNodes for symbolic links discovered in output paths for actions. No verification of the symlink target path occurs. Buildstream, for example, requires this.<tr><td>zstdBufferPoolSize<td>Integer, <em>2048</em><td> <td>Specifies the maximum number of zstd data buffers that may be in use concurrently by the filesystem CAS. Increase to improve compressed blob throughput, decrease to reduce memory usage.<tr><td>persistentWorkerActionMnemonicAllowlist<td>Set<String>, _"*"_</String><td> <td>Controls which Action Mnemonics can run with a persistent worker. Use <code class="language-plaintext highlighter-rouge">*</code> for wildcard.</table></div><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8981</span>
  <span class="na">publicName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">localhost:8981"</span>
  <span class="na">linkedInputDirectories</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">^path/to/common/directory"</span>
</code></pre></div></div><h3 id="capabilities"> <a href="#capabilities" class="anchor-heading" aria-labelledby="capabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Capabilities</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>cas<td>boolean, <em>true</em><td>Enables worker to be a shard of the CAS<tr><td>execution<td>boolean, <em>true</em><td>Enables worker to participate in execution pool</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">capabilities</span><span class="pi">:</span>
    <span class="na">cas</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">execution</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div><h3 id="sandbox-settings"> <a href="#sandbox-settings" class="anchor-heading" aria-labelledby="sandbox-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sandbox Settings</h3><p>Using the sandbox can be configurable by the client via <code class="language-plaintext highlighter-rouge">exec_properties</code>. However, sometimes it is preferred to enable it via buildfarm config to prevent users from running actions outside the sandbox.</p><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>alwaysUseSandbox<td>boolean, <em>false</em><td>Whether or not to always use the sandbox when running actions. It may be preferred to enforce sandbox usage than rely on client selection.<tr><td>alwaysUseAsNobody<td>boolean, <em>false</em><td>Whether or not to always use the as-nobody wrapper when running actions. It may be preferred to enforce this wrapper instead of relying on client selection.<tr><td>alwaysUseCgroups<td>boolean, <em>true</em><td>Whether or not to use cgroups when sandboxing actions. It may be preferred to enforce cgroup usage.<tr><td>alwaysUseTmpFs<td>boolean, <em>false</em><td>Whether or not to always use tmpfs when using the sandbox. It may be preferred to enforce sandbox usage than rely on client selection.<tr><td>additionalWritePaths<td>List of Strings, <em>[]</em><td>Additional paths the sandbox is allowed to write to. Suggestions may include: /tmp, /dev/shm<tr><td>tmpFsPaths<td>List of Strings, <em>[]</em><td>Additional paths the sandbox uses for tmpfs. Suggestions may include: /tmp<tr><td>selectForBlockNetwork<td>boolean, <em>false</em><td>If the action requires “block network” use the sandbox to fulfill this request. Otherwise, there may be no alternative solution and the “block network” request will be ignored / implemented differently.<tr><td>selectForTmpFs<td>boolean, <em>false</em><td>If the action requires “tmpfs” use the sandbox to fulfill this request.execution. Otherwise, there may be no alternative solution and the “tmpfs” request will be ignored / implemented differently.</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">sandboxSettings</span><span class="pi">:</span>
    <span class="na">alwaysUseSandbox</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">alwaysUseAsNobody</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">alwaysUseCgroups</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">alwaysUseTmpFs</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">additionalWritePaths</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">tmpFsPaths</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">selectForBlockNetwork</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">selectForTmpFs</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre></div></div><p>Note: In order for these settings to take effect, you must also configure <code class="language-plaintext highlighter-rouge">limitGlobalExecution: true</code>.</p><h3 id="dequeue-match"> <a href="#dequeue-match" class="anchor-heading" aria-labelledby="dequeue-match"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dequeue Match</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>allowUnmatched<td>boolean, <em>false</em><td> <tr><td>properties<td>List of name/value pairs<td>Pairs of provisions available to match against action properties</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">dequeueMatchSettings</span><span class="pi">:</span>
    <span class="na">allowUnmatched</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">gpu"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nvidia</span><span class="nv"> </span><span class="s">RTX</span><span class="nv"> </span><span class="s">2090"</span>
</code></pre></div></div><h3 id="resources"> <a href="#resources" class="anchor-heading" aria-labelledby="resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Resources</h3><p>A list of limited resources that are available to the worker to be depleted by actions which execute containing a “resource:<name>": "N" property. The dequeueMatchSettings may also further limit executions to contain "resource:<name>" in properties, with either a specific limited resource count as the only accepted value for the action property. The use case here is one where executions are not allowed to request any value other than the one specified. There are no operators currently for asserting an execution requests 'less than' a particular number of resources.</name></name></p><p>The default resource type is SEMAPHORE. The expected use case is that a resource is <em>internally</em> allocated and managed by an execution, and the exhaustion prevents executions from starting which would block or fault if they could not consume the resource. Common examples include licensed software with tokens, and this mechanism can work for singleton resources like one gpu on a worker.</p><p>The POOL resource type is intended for <em>externally</em> defined resource allotment. The Integer range <em>[0,amount)</em> will be created in a pool of free ids provided to The common use case here is multiple gpus on a system, where the concurrent execution on all gpus can take place, but each execution completion frees a different gpu that must be targetted with, for example, the CUDA_VISIBLE_DEVICES env var. The pool takes a resource out of a queue of available ids, and replaces it in the queue when the execution is complete. Since externally defined resources need to be injected into an execution, the depletion of a pool resource applies an automatic execution policy, named ‘pool-<name>', and supplies transformations for both '<_name_>' - expanded to all ids in multiple arguments, or '<_name_-_N_>' for 0-N addressable ids, up to the amount requested. Subsequent literal arguments can provide a delimiter for the wrapper.</_name_-_N_></_name_></name></p><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>name<td>string<td>Resource identifier present on worker<tr><td>type<td><em>SEMAPHORE</em>, POOL<td>Resource count depleted by actions<tr><td>amount<td>Integer<td>Resource count depleted by actions</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">dequeueMatchSettings</span><span class="pi">:</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">resource:special-compiler-license"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span> <span class="c1"># only actions which request one compiler license at a time will be accepted</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">special-compiler-license"</span>
    <span class="na">amount</span><span class="pi">:</span> <span class="m">3</span>
</code></pre></div></div><h3 id="worker-cas"> <a href="#worker-cas" class="anchor-heading" aria-labelledby="worker-cas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Worker CAS</h3><p>Unless specified, options are only relevant for FILESYSTEM type</p><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>type<td><em>FILESYSTEM</em>, GRPC<td>Type of CAS used<tr><td>path<td>String, <em>cache</em><td>Local cache location relative to the ‘root’, or absolute<tr><td>maxSizeBytes<td>Integer, <em>0</em><td>Limit for contents of files retained from CAS in the cache, value of 0 means to auto-configure to 90% of <em>root</em>/<em>path</em> underlying filesystem space<tr><td>fileDirectoriesIndexInMemory<td>boolean, <em>false</em><td>Determines if the file directories bidirectional mapping should be stored in memory or in sqlite<tr><td>skipLoad<td>boolean, <em>false</em><td>Determines if transient data on the worker should be loaded into CAS on worker startup (affects startup time)<tr><td>target<td>String, <em>null</em><td>For GRPC CAS type, target for external CAS endpoint</table></div><p>Example:</p><p>This definition will create a filesystem-based CAS file cache at the path “<root>/cache" on the worker that will reject entries over 2GiB in size, and will expire LRU blobs when the aggregate size of all blobs exceeds 2GiB in order to insert additional entries.</root></p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">storages</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">FILESYSTEM</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cache"</span>
      <span class="na">maxSizeBytes</span><span class="pi">:</span> <span class="m">2147483648</span> <span class="c1"># 2 * 1024 * 1024 * 1024</span>
</code></pre></div></div><p>This definition elides FILESYSTEM configuration with ‘…’, will read-through an external GRPC CAS supporting the REAPI CAS Services into its storage, and will attempt to write expiring entries into the GRPC CAS (i.e. pushing new entries into the head of a worker LRU list will drop the entries from the tail into the GRPC CAS).</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>worker:
  storages:
    - type: FILESYSTEM
      ...
    - type: GRPC
      target: "cas.external.com:1234"
</code></pre></div></div><h3 id="execution-policies"> <a href="#execution-policies" class="anchor-heading" aria-labelledby="execution-policies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Execution Policies</h3><div class="table-wrapper"><table><thead><tr><th>Configuration<th>Accepted and <em>Default</em> Values<th>Description<tbody><tr><td>name<td>String<td>Execution policy name<tr><td>prioritized<td>Boolean, <em>false</em><td>If true, policy will run before built-in policies<tr><td>executionWrapper<td>Execution wrapper, containing a path and list of arguments<td>Execution wrapper, its path and a list of arguments for the wrapper</table></div><p>Example:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">worker</span><span class="pi">:</span>
  <span class="na">executionPolicies</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">as-nobody</span>
      <span class="na">prioritized</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">executionWrapper</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">/app/build_buildfarm/as-nobody</span>
        <span class="na">arguments</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">-u"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">&lt;exec-owner&gt;"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">unshare</span>
      <span class="na">executionWrapper</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">/usr/bin/unshare</span>
        <span class="na">arguments</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">-n"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">-r"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">linux-sandbox</span>
      <span class="na">executionWrapper</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">/app/build_buildfarm/linux-sandbox</span>
        <span class="na">arguments</span><span class="pi">:</span>
          <span class="c1"># use "--" to signal the end of linux-sandbox args. "--" should always be last!</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">--"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">test</span>
      <span class="na">executionWrapper</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">/YOUR/WRAPPER</span>
        <span class="na">arguments</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">arg1</span>
          <span class="pi">-</span> <span class="s">arg2</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">&lt;platform-property-name&gt;"</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">arg1</code> and <code class="language-plaintext highlighter-rouge">arg2</code> are interpreted literally. <code class="language-plaintext highlighter-rouge">&lt;platform-property-value&gt;</code> will be substituted with the value of a property named <code class="language-plaintext highlighter-rouge">"platform-property-name"</code> from a Command’s Platform <em>or</em> the requested pool resources for the execution. If a matching property or pool resource is not found for a specified name, the entire wrapper will be discarded and have no effect on the execution.</p><p><code class="language-plaintext highlighter-rouge">&lt;exec-owner&gt;</code> is an automatically provided pool resource when <code class="language-plaintext highlighter-rouge">execOwner</code> or <code class="language-plaintext highlighter-rouge">execOwners</code> is specified, and will contain the value of the execution’s owner selected for exec tree creation.</p><p>An execution with <code class="language-plaintext highlighter-rouge">as-nobody</code>, <code class="language-plaintext highlighter-rouge">unshare</code>, and <code class="language-plaintext highlighter-rouge">linux-sandbox</code> execution policies enabled would produce a command line like:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/app/build_buildfarm/as-nobody <span class="nt">-u</span> &lt;exec-owner&gt; /usr/bin/unshare <span class="nt">-n</span> <span class="nt">-r</span> /app/build_buildfarm/linux-sandbox <span class="nt">--</span> /YOUR/WRAPPER arg1 arg2 &lt;platform-property-name&gt; ACTION
</code></pre></div></div><p>where ACTION is the Command from remote execution action.</p><hr><h2 class="text-delta">Table of contents</h2><ul><li> <a href="https://buildfarm.github.io/buildfarm/docs/configuration/authentication/">Authentication</a></ul><hr><footer><p class="text-small text-grey-dk-100 mb-0"></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/buildfarm/buildfarm/edit/main/_site/docs/configuration/configuration.md" id="edit-this-page">Edit on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
