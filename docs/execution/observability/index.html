<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/buildfarm/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/buildfarm/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/buildfarm/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/buildfarm/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Observability | Buildfarm</title><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Observability" /><meta property="og:locale" content="en_US" /><meta name="description" content="Remote Caching and Execution" /><meta property="og:description" content="Remote Caching and Execution" /><link rel="canonical" href="https://buildfarm.github.io/buildfarm/docs/execution/observability/" /><meta property="og:url" content="https://buildfarm.github.io/buildfarm/docs/execution/observability/" /><meta property="og:site_name" content="Buildfarm" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Observability" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Remote Caching and Execution","headline":"Observability","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://buildfarm.github.io/buildfarm/assets/images/buildfarm-logo.png"}},"url":"https://buildfarm.github.io/buildfarm/docs/execution/observability/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://buildfarm.github.io/buildfarm/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/features/" class="nav-list-link">Features</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/quick_start/" class="nav-list-link">Quick Start</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/configuration/configuration/" class="nav-list-link">Configuration</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/configuration/authentication/" class="nav-list-link">Authentication</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/architecture/architecture/" class="nav-list-link">Architecture</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/instance_types/" class="nav-list-link">Instance Types</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/workers/" class="nav-list-link">Workers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/schedulers/" class="nav-list-link">Schedulers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/worker-execution-environment/" class="nav-list-link">Worker Execution Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/queues/" class="nav-list-link">Queues</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/action_cache/" class="nav-list-link">Action Cache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/CASFileCache/" class="nav-list-link">CASFileCache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/content_addressable_storage/" class="nav-list-link">CAS</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/redis/" class="nav-list-link">Redis</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution/" class="nav-list-link">Execution</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/" class="nav-list-link">Debugging</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/environment/" class="nav-list-link">Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/exec_owner/" class="nav-list-link">Owner</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_limiting/" class="nav-list-link">Limiting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/builds-without-the-bytes/" class="nav-list-link">Build Without Bytes</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_properties/" class="nav-list-link">Properties</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_policies/" class="nav-list-link">Policies</a><li class="nav-list-item active"><a href="https://buildfarm.github.io/buildfarm/docs/execution/observability/" class="nav-list-link active">Observability</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/metrics/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/metrics/alerts/" class="nav-list-link">Alerts</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/tools/tools/" class="nav-list-link">Tools</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/troubleshooting-bazel-remote-execution/" class="nav-list-link">Troubleshooting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/bf-cat/" class="nav-list-link">bf-cat</a></ul><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/admin/" class="nav-list-link">Admin</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/contribute/contribute/" class="nav-list-link">Contribute</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/local_development/" class="nav-list-link">Local Development</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/design-documents/" class="nav-list-link">Design Documents</a></ul></ul></nav><footer class="site-footer"></footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Buildfarm" aria-label="Search Buildfarm" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/buildfarm/buildfarm" class="site-button" > GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution/">Execution</a><li class="breadcrumb-nav-list-item"><span>Observability</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="observability"> <a href="#observability" class="anchor-heading" aria-labelledby="observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Observability</h1><p>Executions are organized by a hierarchy of ownership, and indexed with client-specified fields. The <a href="https://cloud.google.com/service-infrastructure/docs/service-management/reference/rpc/google.longrunning">longrunning.operations</a> API can be used to find a configuration-limited number of executions organized in this hierarchy by <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">filter</code>.</p><h2 id="hierarchy"> <a href="#hierarchy" class="anchor-heading" aria-labelledby="hierarchy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hierarchy</h2><ul><li>Correlated Invocations - specified by build tool invoker<ul><li>Tool Invocation - generated internally by build tool<ul><li>Execution - generated internally by buildfarm</ul></ul></ul><p>An <em>Execution</em> is an individual Execute request made from a client to buildfarm. The names for all Executions on buildfarm will be the string <code class="language-plaintext highlighter-rouge">&lt;instance name&gt;/executions/&lt;uuid&gt;</code>, with <code class="language-plaintext highlighter-rouge">uuid</code> being generated after the Execute call is made.</p><p>A <em>Tool Invocation</em> is an organization of all requests made by a client during one logical user invocation. For instance, <code class="language-plaintext highlighter-rouge">bazel</code>, as a <em>tool</em>, will generate a UUID per <em>invocation</em>, usually by a user or CI script - e.g: each time you run <code class="language-plaintext highlighter-rouge">bazel</code>, it generates internally and uses a different <code class="language-plaintext highlighter-rouge">toolInvocationId</code>, making this a collection of <em>Executions</em> (and other requests) per run.</p><p>A set of <em>Correlated Invocations</em> is uniquely identified by another UUID, the <code class="language-plaintext highlighter-rouge">correlatedInvocationsId</code>, which is expected to encompass one or more <em>Tool Invocations</em>. A build tool will provide the mechanism to specify this by a user - e.g: each time you run <code class="language-plaintext highlighter-rouge">bazel</code>, you can specify the same <code class="language-plaintext highlighter-rouge">--build_request_id</code> to indicate that a run is a member of a collection of <em>Tool Invocations</em>. The correlatedInvocationsId must be a string that <em>ends</em> with an 8-4-4-4-12 format UUID string (important because this value is completely specified by a client user), otherwise it is ignored and buildfarm will emit a warning.</p><h2 id="indexing"> <a href="#indexing" class="anchor-heading" aria-labelledby="indexing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Indexing</h2><p>Note that the <code class="language-plaintext highlighter-rouge">correlatedInvocationsId</code> only needs to <em>end</em> in a UUID. This means that before the end of the id, this can contain whatever identifying information we want.</p><p>Buildfarm has taken steps that make it beneficial to provide this information as a URI. The <code class="language-plaintext highlighter-rouge">fragment</code> of the URI is an excellent place to specify the required trailing UUID. For example, our archetypal builder “Alice” provided this:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://alice@dev-workstation/projects/winthorp/modules/interpreter?org=database&amp;milestone=epsilon#fda159f2-bafe-4270-91ba-c7a946c0f2ba
</code></pre></div></div><p>She’s specified a userinfo containing her <code class="language-plaintext highlighter-rouge">username</code> (the <code class="language-plaintext highlighter-rouge">password</code> field of <code class="language-plaintext highlighter-rouge">userinfo</code> will be ignored by buildfarm), the <code class="language-plaintext highlighter-rouge">host</code> the build ran on, a path that identified her <code class="language-plaintext highlighter-rouge">project</code> and its <code class="language-plaintext highlighter-rouge">module</code> per her organization, which is listed here as <code class="language-plaintext highlighter-rouge">database</code>, and she’s clearly working on the ‘epsilon’ <code class="language-plaintext highlighter-rouge">milestone</code>. Trailing it after a fragment separator is the required uuid.</p><p>A single layer of optional indexing is provided in buildfarm to collect <em>Correlated Invocations</em> with useful identifying information.</p><p>The indexing starts with the configuration of buildfarm’s server:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">correlatedInvocationsIndexScopes</span><span class="err">:</span> <span class="kt">!!set</span>
    <span class="pi">?</span> <span class="s">host</span>
    <span class="pi">?</span> <span class="s">username</span>
</code></pre></div></div><p>This means that the <code class="language-plaintext highlighter-rouge">host</code> and <code class="language-plaintext highlighter-rouge">username</code> fields should be indexed for correlatedInvocationsIds observed. This configuration is the default, and you may remove or add any indexing you wish.</p><p>These values are extracted from the correlatedInvocationsId on every request, and must not differ in content contained within the URI without also changing the UUID, in order to guarantee proper indexing. Any values other than the above will be extracted from the query of the URI - <code class="language-plaintext highlighter-rouge">host</code> will come from the component in <code class="language-plaintext highlighter-rouge">authority</code>, and <code class="language-plaintext highlighter-rouge">username</code> from <code class="language-plaintext highlighter-rouge">userinfo</code>.</p><p>These will create indices which identify <code class="language-plaintext highlighter-rouge">correlatedInvocations</code> via the UUID portion of the correlatedInvocationsId, making this a series of collections of <em>correlatedInvocations</em></p><h2 id="listoperations"> <a href="#listoperations" class="anchor-heading" aria-labelledby="listoperations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> listOperations</h2><p>The Longrunning Operations method <code class="language-plaintext highlighter-rouge">listOperations</code> will serve as the entry point to discover elements of this hierarchy.</p><p>In the interest of a speedy response, the Operations it returns will not have any details other than <code class="language-plaintext highlighter-rouge">name</code> populated. More detailed information about a name returned can be queried with <code class="language-plaintext highlighter-rouge">getOperation</code>. The <code class="language-plaintext highlighter-rouge">listOperations</code> response can then be considered a list of names for these examples.</p><p>The ListOperationsRequest <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">filter</code> fields have several special meanings intended for discovery. The instance name listed here will be <code class="language-plaintext highlighter-rouge">solomon</code> for identification purposes.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ListOperationsRequest({
  name: "solomon",
})
</code></pre></div></div><p>Will yield the names of the indices and special bindings. In the case of the above, after running a build with the above <code class="language-plaintext highlighter-rouge">correlatedInvocationsId</code> and configuration:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>executions
toolInvocations
correlatedInvocations
host
username
</code></pre></div></div><p>To discover the available <code class="language-plaintext highlighter-rouge">correlatedInvocations</code> index entries for <code class="language-plaintext highlighter-rouge">username</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ListOperationsRequest({
  name: "solomon/username",
})
</code></pre></div></div><p>Which will yield:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username=alice
username=bob
username=mallory
</code></pre></div></div><p>For a system where usernames <code class="language-plaintext highlighter-rouge">alice</code>, <code class="language-plaintext highlighter-rouge">bob</code>, and <code class="language-plaintext highlighter-rouge">mallory</code> have been presented in <code class="language-plaintext highlighter-rouge">correlatedInvocationsId</code> URIs.</p><p>To see the <code class="language-plaintext highlighter-rouge">correlatedInvocationsIds</code> for <code class="language-plaintext highlighter-rouge">mallory</code>, we can switch to a filter and select the <code class="language-plaintext highlighter-rouge">correlatedInvocations</code> parent resource:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ListOperationsRequest({
  name: "solomon/correlatedInvocations",
  filter: "username=mallory",
})
</code></pre></div></div><p>Note that the format is the same as the one in the output of the index entries result. This yields:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0c1ce9e6-471d-4265-b15b-885e42670fdb
7bd7f8d2-6628-4f3f-a7e3-9eff917eb697
6ca27615-4fb5-4ffc-9349-d484926bd05e
</code></pre></div></div><p>So <code class="language-plaintext highlighter-rouge">username=mallory</code> is associated with these three <code class="language-plaintext highlighter-rouge">correlatedInvocations</code>. These are <code class="language-plaintext highlighter-rouge">correlatedInvocationsId</code>s which can be passed to the <code class="language-plaintext highlighter-rouge">toolInvocations</code> parent resource:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ListOperationsRequest({
  name: "solomon/toolInvocations",
  filter: "correlatedInvocationId=0c1ce9e6-471d-4265-b15b-885e42670fdb",
})
</code></pre></div></div><p>To get a list of <code class="language-plaintext highlighter-rouge">toolInvocationId</code>s:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fad33d5e-fbba-483d-8df4-4502621caff2
44e516cd-d8fd-4c61-90d2-9389402242a4
</code></pre></div></div><p>This <code class="language-plaintext highlighter-rouge">correlatedInvocationId</code> was used in two client invocations. Our last stop on the hierarchy is to pass this to the <code class="language-plaintext highlighter-rouge">executions</code> binding associated with its <code class="language-plaintext highlighter-rouge">toolInvocationId</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ListOperationsRequest({
  name: "solomon/executions",
  filter: "toolInvocationId=fad33d5e-fbba-483d-8df4-4502621caff2",
})
</code></pre></div></div><p>This yields a huge list of the names of executions that the <code class="language-plaintext highlighter-rouge">toolInvocation</code> <code class="language-plaintext highlighter-rouge">fad33d5e-fbba-483d-8df4-4502621caff2</code> requested via the <code class="language-plaintext highlighter-rouge">Execute</code> method.</p><p>The Operation-encapsulated information from these execution UUID results can be retrieved via <code class="language-plaintext highlighter-rouge">getOperation</code> with a name of <code class="language-plaintext highlighter-rouge">solomon/executions/&lt;uuid&gt;</code>. Those executions will have a wealth of information about where and how they executed, and will be up to date with the current reporting if the execution is still in flight.</p><h2 id="tools"> <a href="#tools" class="anchor-heading" aria-labelledby="tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tools</h2><p>bf-cat can issue all of the example requests listed here to both <code class="language-plaintext highlighter-rouge">listOperations</code> and <code class="language-plaintext highlighter-rouge">getOperation</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bf-cat ... Operations &lt;filter&gt; &lt;name-without-index&gt;
</code></pre></div></div><p>for <code class="language-plaintext highlighter-rouge">listOperations</code>, and</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bf-cat ... Operation &lt;operation-name&gt; [&lt;more-operation-names&gt;...]
</code></pre></div></div><p>for <code class="language-plaintext highlighter-rouge">getOperation</code>, which supports requesting multiple uuids in a single invocation.</p><hr><footer><p class="text-small text-grey-dk-100 mb-0"></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/buildfarm/buildfarm/edit/main/_site/docs/execution/observability.md" id="edit-this-page">Edit on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
