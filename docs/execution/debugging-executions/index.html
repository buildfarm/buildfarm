<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/buildfarm/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/buildfarm/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/buildfarm/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/buildfarm/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Debugging | Buildfarm</title><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Debugging" /><meta property="og:locale" content="en_US" /><meta name="description" content="Remote Caching and Execution" /><meta property="og:description" content="Remote Caching and Execution" /><link rel="canonical" href="https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/" /><meta property="og:url" content="https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/" /><meta property="og:site_name" content="Buildfarm" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Debugging" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Remote Caching and Execution","headline":"Debugging","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://buildfarm.github.io/buildfarm/assets/images/buildfarm-logo.png"}},"url":"https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://buildfarm.github.io/buildfarm/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/features/" class="nav-list-link">Features</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/quick_start/" class="nav-list-link">Quick Start</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/configuration/configuration/" class="nav-list-link">Configuration</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/configuration/authentication/" class="nav-list-link">Authentication</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/architecture/architecture/" class="nav-list-link">Architecture</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/instance_types/" class="nav-list-link">Instance Types</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/workers/" class="nav-list-link">Workers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/schedulers/" class="nav-list-link">Schedulers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/worker-execution-environment/" class="nav-list-link">Worker Execution Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/queues/" class="nav-list-link">Queues</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/action_cache/" class="nav-list-link">Action Cache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/CASFileCache/" class="nav-list-link">CASFileCache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/content_addressable_storage/" class="nav-list-link">CAS</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/redis/" class="nav-list-link">Redis</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution/" class="nav-list-link">Execution</a><ul class="nav-list "><li class="nav-list-item active"><a href="https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/" class="nav-list-link active">Debugging</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/environment/" class="nav-list-link">Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/exec_owner/" class="nav-list-link">Owner</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_limiting/" class="nav-list-link">Limiting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/builds-without-the-bytes/" class="nav-list-link">Build Without Bytes</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_properties/" class="nav-list-link">Properties</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_policies/" class="nav-list-link">Policies</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/observability/" class="nav-list-link">Observability</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/metrics/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/metrics/alerts/" class="nav-list-link">Alerts</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/tools/tools/" class="nav-list-link">Tools</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/troubleshooting-bazel-remote-execution/" class="nav-list-link">Troubleshooting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/bf-cat/" class="nav-list-link">bf-cat</a></ul><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/admin/" class="nav-list-link">Admin</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/contribute/contribute/" class="nav-list-link">Contribute</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/local_development/" class="nav-list-link">Local Development</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/design-documents/" class="nav-list-link">Design Documents</a></ul></ul></nav><footer class="site-footer"></footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Buildfarm" aria-label="Search Buildfarm" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/buildfarm/buildfarm" class="site-button" > GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution/">Execution</a><li class="breadcrumb-nav-list-item"><span>Debugging</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="debugging-executions"> <a href="#debugging-executions" class="anchor-heading" aria-labelledby="debugging-executions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging Executions</h1><p>This tutorial is intended to guide you in debugging executions that are run on buildfarm.</p><h3 id="problem"> <a href="#problem" class="anchor-heading" aria-labelledby="problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problem</h3><p>Build actions (and more specifically unit tests) often behave differently across environments. This makes it difficult to understand and debug remote action behavior. The execution environment of buildfarm may seem like an inaccessible black-box to the client. The problem is further complicated by the fact that buildfarm’s executor may not be using the same tools locally as the build system (such as bazel’s sandbox or process-wrapper). In buildfarm, these tools are chosen based on the configuration of execution wrappers, and custom execution wrappers exist as well. Buildfarm may also virtualize hardware and apply restrictions on resources such as cpu, memory, and network. Additionally, buildfarm actions do not always run on the same machine. Actions in buildfarm are directed to particular eligible workers based on their platform properties. Despite the platform properties of the worker chosen, the action may run inside a docker container which also affects the execution environment.</p><h3 id="capturing-debug-information-before-execution"> <a href="#capturing-debug-information-before-execution" class="anchor-heading" aria-labelledby="capturing-debug-information-before-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Capturing debug information (before execution)</h3><p>There are execution properties available to help you capture debug information dynamically when performing executions. To capture initial information about an execution, you can use the following:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel test --remote_default_exec_properties='debug-before-execution=true'  \
--remote_executor=grpc://127.0.0.1:8980 \
--noremote_accept_cached  \
--nocache_test_results
//&lt;TARGET&gt;
</code></pre></div></div><p>Assuming the action is properly queued and reaches the executor, the executor will deliberately fail the action and send you debug information via json through the action’s stderr. You can view this debug information by reading the failure log:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat source/bazel-out/k8-fastbuild/testlogs/&lt;TARGET&gt;/test.log
</code></pre></div></div><p>You can streamline viewing this information via <code class="language-plaintext highlighter-rouge">--test_output=streamed</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel test \
--test_output=streamed \
--remote_default_exec_properties='debug-before-execution=true' \
--noremote_accept_cached \
--nocache_test_results \
//&lt;TARGET&gt;
</code></pre></div></div><h3 id="capturing-debug-information-after-execution"> <a href="#capturing-debug-information-after-execution" class="anchor-heading" aria-labelledby="capturing-debug-information-after-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Capturing debug information (after execution)</h3><p>A similar property exists that will tell the executor to run the action, and after the action finishes, return debug information.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel test \
--test_output=streamed \
--remote_default_exec_properties='debug-after-execution=true' \
--noremote_accept_cached \
--nocache_test_results \
//&lt;TARGET&gt;
</code></pre></div></div><p>If your action is hanging, you might not be able to get this debug information and should stick with ‘debug-before-execution=true’. If your action is finishing, this would be a ideal to use, as it should provide all the same information that ‘debug-before-execution=true’ does, with additional info about the execution.</p><h3 id="configuration"> <a href="#configuration" class="anchor-heading" aria-labelledby="configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration</h3><p>If you see an error like this:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>properties are not valid for queue eligibility: [name: "debug-before-execution" value: "true"]
</code></pre></div></div><p>you will need to configure the queue’s <code class="language-plaintext highlighter-rouge">allow_unmatched</code> to true so that the server can still put the action on the queue. Additionally you may want to configure the the worker’s <code class="language-plaintext highlighter-rouge">DequeueMatchSettings</code> to also have <code class="language-plaintext highlighter-rouge">allow_unmatched</code> to true. That will ensure the action does not fail reaching one of the worker due to the additional exec_property.</p><h3 id="debugging-tests"> <a href="#debugging-tests" class="anchor-heading" aria-labelledby="debugging-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging Tests</h3><p>By default, <code class="language-plaintext highlighter-rouge">debug-before-execution</code> and <code class="language-plaintext highlighter-rouge">debug-after-execution</code> only apply to test actions. The reason being, is that if you wanted to debug a test, but passed a global property like <code class="language-plaintext highlighter-rouge">--remote_default_exec_properties='debug-before-execution=true'</code>, it would invalidate all the actions, and the test would need rebuilt, but the rebuild of the test would fail, because you would actually be debugging the first build action, and you would never see the debug results of the test action. Debugging tests is more typical, but you can also debug build actions by using <code class="language-plaintext highlighter-rouge">--remote_default_exec_properties='debug-tests-only=false'</code>.</p><p>It is more convenient to debug things by passing the global exec properties, but you could also tag targets specifically in the BUILD files with these debug options.</p><h3 id="finding-operations"> <a href="#finding-operations" class="anchor-heading" aria-labelledby="finding-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Finding Operations</h3><p>All buildfarm operations can be found using the following query:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel run //src/main/java/build/buildfarm:bf-find-operations localhost:8980 shard SHA256
</code></pre></div></div><p>When you run a build invocation with bazel, bazel will you give you an invocation id. You can use that to query your specific operations:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel run //src/main/java/build/buildfarm:bf-find-operations localhost:8980 shard SHA256 "[?(@.operation.metadata.requestMetadata.toolInvocationId == '1877f43a-9b33-4eca-9d6b-aef71b47bf47')]"
</code></pre></div></div><p>You can find the operation of a specific test name like this:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel run //src/main/java/build/buildfarm:bf-find-operations localhost:8980 shard SHA256 "$.command.environmentVariables[?(@.value == '//code/tools/example_tests/bash_hello_world2:main')]"
</code></pre></div></div><hr><footer><p class="text-small text-grey-dk-100 mb-0"></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/buildfarm/buildfarm/edit/main/_site/docs/execution/debugging-executions.md" id="edit-this-page">Edit on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
