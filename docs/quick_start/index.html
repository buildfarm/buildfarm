<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/buildfarm/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/buildfarm/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/buildfarm/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/buildfarm/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Quick Start | Buildfarm</title><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Quick Start" /><meta property="og:locale" content="en_US" /><meta name="description" content="Remote Caching and Execution" /><meta property="og:description" content="Remote Caching and Execution" /><link rel="canonical" href="https://buildfarm.github.io/buildfarm/docs/quick_start/" /><meta property="og:url" content="https://buildfarm.github.io/buildfarm/docs/quick_start/" /><meta property="og:site_name" content="Buildfarm" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Quick Start" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Remote Caching and Execution","headline":"Quick Start","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://buildfarm.github.io/buildfarm/assets/images/buildfarm-logo.png"}},"url":"https://buildfarm.github.io/buildfarm/docs/quick_start/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://buildfarm.github.io/buildfarm/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/features/" class="nav-list-link">Features</a><li class="nav-list-item active"><a href="https://buildfarm.github.io/buildfarm/docs/quick_start/" class="nav-list-link active">Quick Start</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/configuration/configuration/" class="nav-list-link">Configuration</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/configuration/authentication/" class="nav-list-link">Authentication</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/architecture/architecture/" class="nav-list-link">Architecture</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/instance_types/" class="nav-list-link">Instance Types</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/workers/" class="nav-list-link">Workers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/schedulers/" class="nav-list-link">Schedulers</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/worker-execution-environment/" class="nav-list-link">Worker Execution Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/queues/" class="nav-list-link">Queues</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/action_cache/" class="nav-list-link">Action Cache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/CASFileCache/" class="nav-list-link">CASFileCache</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/content_addressable_storage/" class="nav-list-link">CAS</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/architecture/redis/" class="nav-list-link">Redis</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution/" class="nav-list-link">Execution</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/debugging-executions/" class="nav-list-link">Debugging</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/environment/" class="nav-list-link">Environment</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/exec_owner/" class="nav-list-link">Owner</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_limiting/" class="nav-list-link">Limiting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/builds-without-the-bytes/" class="nav-list-link">Build Without Bytes</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_properties/" class="nav-list-link">Properties</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/execution_policies/" class="nav-list-link">Policies</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/execution/observability/" class="nav-list-link">Observability</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/metrics/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/metrics/alerts/" class="nav-list-link">Alerts</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/tools/tools/" class="nav-list-link">Tools</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/troubleshooting-bazel-remote-execution/" class="nav-list-link">Troubleshooting</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/tools/bf-cat/" class="nav-list-link">bf-cat</a></ul><li class="nav-list-item"><a href="https://buildfarm.github.io/buildfarm/docs/admin/" class="nav-list-link">Admin</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://buildfarm.github.io/buildfarm/docs/contribute/contribute/" class="nav-list-link">Contribute</a><ul class="nav-list "><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/local_development/" class="nav-list-link">Local Development</a><li class="nav-list-item "><a href="https://buildfarm.github.io/buildfarm/docs/contribute/design-documents/" class="nav-list-link">Design Documents</a></ul></ul></nav><footer class="site-footer"></footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Buildfarm" aria-label="Search Buildfarm" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/buildfarm/buildfarm" class="site-button" > GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><h1 id="quick-start"> <a href="#quick-start" class="anchor-heading" aria-labelledby="quick-start"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Quick Start</h1><p>Here we describe how to use bazel remote caching or remote execution with buildfarm. We will create a single client workspace that can be used for both.</p><h2 id="setup"> <a href="#setup" class="anchor-heading" aria-labelledby="setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setup</h2><p>You can run this quick start on a single computer running any flavor of linux that bazel supports. A C++ compiler is used here to demonstrate action execution. This computer is the localhost for the rest of the description.</p><h3 id="backplane"> <a href="#backplane" class="anchor-heading" aria-labelledby="backplane"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backplane</h3><p>Buildfarm requires a backplane to store information that is shared between cluster members. A <a href="https://redis.io">redis</a> server can be used to meet this requirement.</p><p>Download/Install a redis-server instance and run it on your localhost. The default redis port of 6379 will be used by the default buildfarm configs.</p><h2 id="workspace"> <a href="#workspace" class="anchor-heading" aria-labelledby="workspace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Workspace</h2><p>Let’s start with a bazel workspace with a single file to compile into an executable:</p><p>Create a new directory for our workspace and add the following files:</p><p><code class="language-plaintext highlighter-rouge">main.cc</code>:</p><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Hello, World!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">BUILD</code>:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">cc_binary</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">main</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">main.cc</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div><p>And an empty WORKSPACE file.</p><p>As a test, verify that <code class="language-plaintext highlighter-rouge">bazel run :main</code> builds your main program and runs it, and prints <code class="language-plaintext highlighter-rouge">Hello, World!</code>. This will ensure that you have properly installed <code class="language-plaintext highlighter-rouge">bazel</code> and a C++ compiler, and have a working target before moving on to remote caching or remote execution.</p><p>Download and extract the buildfarm repository. Each command sequence below will have the intended working directory indicated, between the client (workspace running bazel), and buildfarm.</p><p>This tutorial assumes that you have a bazel binary in your path and you are in the root of your buildfarm clone/release, and has been tested to work with bash on linux.</p><h2 id="remote-caching"> <a href="#remote-caching" class="anchor-heading" aria-labelledby="remote-caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Remote Caching</h2><p>A Buildfarm cluster can be used strictly as an ActionCache (AC) and ContentAddressableStorage (CAS) to improve build performance. This is an example of running a bazel client that will retrieve results if available, otherwise store them on a cache miss after executing locally.</p><p>Download the buildfarm repository and change into its directory, then:</p><ul><li>run <code class="language-plaintext highlighter-rouge">bazel run src/main/java/build/buildfarm:buildfarm-server $PWD/examples/config.minimal.yml</code></ul><p>This will wait while the server runs, indicating that it is ready for requests.</p><p>A server alone does not itself store the content of action results. It acts as an endpoint for any number of workers that present storage, so we must also start a single worker.</p><p>From another prompt (i.e. a separate terminal) in the buildfarm repository directory:</p><ul><li>run <code class="language-plaintext highlighter-rouge">bazel run src/main/java/build/buildfarm:buildfarm-shard-worker -- --prometheus_port=9091 $PWD/examples/config.minimal.yml</code></ul><p>The <code class="language-plaintext highlighter-rouge">--</code> option is bazel convention to treat all subsequent arguments as parameters to the running app, like our <code class="language-plaintext highlighter-rouge">--prometheus_port</code>, instead of interpreting them with <code class="language-plaintext highlighter-rouge">run</code> The <code class="language-plaintext highlighter-rouge">--prometheus_port=9091</code> option allows this worker to run alongside our server, who will have started and logged that it has started a service on port <code class="language-plaintext highlighter-rouge">9090</code>. You can also turn this option off (with <code class="language-plaintext highlighter-rouge">--</code> separator), with <code class="language-plaintext highlighter-rouge">--prometheus_option=0</code> for either server or worker. This will also wait while the worker runs, indicating it will be available to store cache content.</p><p>From another prompt in your newly created workspace directory from above:</p><ul><li>run <code class="language-plaintext highlighter-rouge">bazel clean</code><li>run <code class="language-plaintext highlighter-rouge">bazel run --remote_cache=grpc://localhost:8980 :main</code></ul><p>Why do we clean here? Since we’re verifying re-execution and caching, this ensures that we will execute any actions in the <code class="language-plaintext highlighter-rouge">run</code> step and interact with the remote cache. We should be attempting to retrieve cached results, and then when we miss - since we just started this memory resident server - bazel will upload the results of the execution for later use. There will be no change in the output of this bazel run if everything worked, since bazel does not provide output each time it uploads results.</p><p>To prove that we have placed something in the action cache, we need to do the following:</p><ul><li>run <code class="language-plaintext highlighter-rouge">bazel clean</code><li>run <code class="language-plaintext highlighter-rouge">bazel run --remote_cache=grpc://localhost:8980 :main</code></ul><p>This should now print statistics on the <code class="language-plaintext highlighter-rouge">processes</code> line that indicate that you’ve retrieved results from the cache for your actions:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: 2 processes: 2 remote cache hit.
</code></pre></div></div><h2 id="remote-execution-and-caching"> <a href="#remote-execution-and-caching" class="anchor-heading" aria-labelledby="remote-execution-and-caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Remote Execution (and caching)</h2><p>Now we will use buildfarm for remote execution with a minimal configuration with a worker on the localhost that can execute a single process at a time, via a bazel invocation on our workspace.</p><p>First, to clean out the results from the previous cached actions, flush your local redis database:</p><ul><li>run <code class="language-plaintext highlighter-rouge">redis-cli flushdb</code></ul><p>Next, we should restart the buildfarm server, and delete the worker’s cas storage to ensure that we get remote execution (this can also be forced from the client by using <code class="language-plaintext highlighter-rouge">--noremote_accept_cached</code>). From the buildfarm server prompt and directory:</p><ul><li>interrupt the running <code class="language-plaintext highlighter-rouge">buildfarm-server</code> (i.e. Ctrl-C)<li>run <code class="language-plaintext highlighter-rouge">bazel run src/main/java/build/buildfarm:buildfarm-server $PWD/examples/config.minimal.yml</code></ul><p>You can leave the worker running from the Remote Caching step, it will not require a restart</p><p>From another prompt, in your client workspace:</p><ul><li>run <code class="language-plaintext highlighter-rouge">bazel run --remote_executor=grpc://localhost:8980 :main</code></ul><p>Your build should now print out the following on its <code class="language-plaintext highlighter-rouge">processes</code> summary line:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: 2 processes: 2 remote.
</code></pre></div></div><p>That <code class="language-plaintext highlighter-rouge">2 remote</code> indicates that your compile and link ran remotely. Congratulations, you just build something through remote execution!</p><h2 id="container-quick-start"> <a href="#container-quick-start" class="anchor-heading" aria-labelledby="container-quick-start"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Container Quick Start</h2><p>To bring up a minimal buildfarm cluster, you can run:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./examples/bf-run start
</code></pre></div></div><p>This will start all of the necessary containers at the latest version. Once the containers are up, you can build with <code class="language-plaintext highlighter-rouge">bazel run --remote_executor=grpc://localhost:8980 :main</code>.</p><p>To stop the containers, run:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./examples/bf-run stop
</code></pre></div></div><h2 id="next-steps"> <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps</h2><p>We’ve started our worker on the same host as our server, and also the same host on which we built with bazel, but these services can be spread across many machines, per ‘remote’. A large number of workers, with a relatively small number of servers (10:1 and 100:1 ratios have been used in practice), consolidating large disks and beefy multicore cpus/gpus on workers, with specialization of what work they perform for bazel builds (or other client work), and specializing servers to have hefty network connections to funnel content traffic. A buildfarm deployment can service hundreds or thousands of developers or CI processes, enabling them to benefit from each others’ shared context in the AC/CAS, and the pooled execution of a fleet of worker hosts eager to consume operations and deliver results.</p><h2 id="buildfarm-manager"> <a href="#buildfarm-manager" class="anchor-heading" aria-labelledby="buildfarm-manager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Buildfarm Manager</h2><p>You can now easily launch a new Buildfarm cluster locally or in AWS using an open sourced <a href="https://github.com/80degreeswest/bfmgr">Buildfarm Manager</a>.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget https://github.com/80degreeswest/bfmgr/releases/download/1.0.7/bfmgr-1.0.7.jar
<span class="nv">$ </span>java <span class="nt">-jar</span> bfmgr-1.0.7.jar
<span class="nv">$ </span>open http://localhost
</code></pre></div></div><hr><footer><p class="text-small text-grey-dk-100 mb-0"></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/buildfarm/buildfarm/edit/main/_site/docs/quick_start.md" id="edit-this-page">Edit on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
