<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/bazel-buildfarm/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/bazel-buildfarm/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/bazel-buildfarm/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/bazel-buildfarm/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Build Without Bytes | Buildfarm</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Build Without Bytes" /><meta property="og:locale" content="en_US" /><meta name="description" content="Remote Execution for Bazel" /><meta property="og:description" content="Remote Execution for Bazel" /><link rel="canonical" href="http://localhost:4000/bazel-buildfarm/docs/execution/builds-without-the-bytes/" /><meta property="og:url" content="http://localhost:4000/bazel-buildfarm/docs/execution/builds-without-the-bytes/" /><meta property="og:site_name" content="Buildfarm" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Build Without Bytes" /> <script type="application/ld+json"> {"@type":"WebPage","url":"http://localhost:4000/bazel-buildfarm/docs/execution/builds-without-the-bytes/","headline":"Build Without Bytes","description":"Remote Execution for Bazel","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <img src="http://localhost:4000/bazel-buildfarm/assets/images/bazel-logo.png" alt="bazel logo" style="width:53px"> <a href="http://localhost:4000/bazel-buildfarm/" class="site-title lh-tight"> Buildfarm </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/bazel-buildfarm/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="http://localhost:4000/bazel-buildfarm/docs/features/" class="nav-list-link">Features</a><li class="nav-list-item"><a href="http://localhost:4000/bazel-buildfarm/docs/quick_start/" class="nav-list-link">Quick Start</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/architecture/" class="nav-list-link">Architecture</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/instance_types/" class="nav-list-link">Instance Types</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/workers/" class="nav-list-link">Workers</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/schedulers/" class="nav-list-link">Schedulers</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/worker-execution-environment/" class="nav-list-link">Workers</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/queues/" class="nav-list-link">Queues</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/action_cache/" class="nav-list-link">Action Cache</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/CASFileCache/" class="nav-list-link">CASFileCache</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/content_addressable_storage/" class="nav-list-link">CAS</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/architecture/redis/" class="nav-list-link">Redis</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/bazel-buildfarm/docs/execution/execution/" class="nav-list-link">Execution</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/execution/debugging-executions/" class="nav-list-link">Debugging</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/execution/environment/" class="nav-list-link">Enviornment</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/execution/exec_owner/" class="nav-list-link">Owner</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/execution/execution_limiting/" class="nav-list-link">Limiting</a><li class="nav-list-item active"><a href="http://localhost:4000/bazel-buildfarm/docs/execution/builds-without-the-bytes/" class="nav-list-link active">Build Without Bytes</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/execution/execution_properties/" class="nav-list-link">Properties</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/execution/execution_policies/" class="nav-list-link">Policies</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/bazel-buildfarm/docs/metrics/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/metrics/alerts/" class="nav-list-link">Alerts</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/bazel-buildfarm/docs/tools/tools/" class="nav-list-link">Tools</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/tools/troubleshooting-bazel-remote-execution/" class="nav-list-link">Troubleshooting</a><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/tools/bf-cat/" class="nav-list-link">bf-cat</a></ul><li class="nav-list-item"><a href="http://localhost:4000/bazel-buildfarm/docs/admin/" class="nav-list-link">Admin</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/bazel-buildfarm/docs/contribute/contribute/" class="nav-list-link">Contribute</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/bazel-buildfarm/docs/contribute/design-documents/" class="nav-list-link">Design Documents</a></ul></ul></nav><footer class="site-footer"></footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Buildfarm" aria-label="Search Buildfarm" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://github.com/bazelbuild/bazel-buildfarm" class="site-button" > GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/bazel-buildfarm/docs/execution/execution/">Execution</a><li class="breadcrumb-nav-list-item"><span>Build Without Bytes</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="builds-without-the-bytes"> <a href="#builds-without-the-bytes" class="anchor-heading" aria-labelledby="builds-without-the-bytes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Builds Without The Bytes</h1><p>tl;dr: add <code class="language-plaintext highlighter-rouge">--build_request_id=https://host?ENSURE_OUTPUTS_PRESENT=true#$(uuidgen)</code> to your BWOB bazel invocations.</p><p>As proposed in this <a href="https://github.com/bazelbuild/bazel/issues/6862">issue</a> and the accompanying document, bazel endeavors to provide a mechanism to be ‘content-light’ for remote execution, using only content reference addresses to request action execution and construct successively dependent action definitions.</p><p>Simply put, Builds Without The Bytes skips the download of action result artifacts until it needs them.</p><p>This puts BuildFarm in the uncomfortable position of never being able to expire any unique content associated with ActionResults, which is not something easily accomplished. It extends the required lifetime to some duration where bazel retains references, and if it encounters a situation where it either wants them, or to execute an action that depends upon them, and they are not available, it fails.</p><p>To combat this, you can provide some metadata to buildfarm that will help to limit (but will not remove the possibility of) failed builds.</p><p>Bazel presents a ‘correlated_invocations_id’ on every request to BuildFarm, including the GetActionResult request, which it uses to retrieve cached results. Since ActionResults are the long tail survivor of actions, being retained for much longer after one executes and produces its content, this represents the most likely position where content may have been removed, and a stale reference might be provided. BuildFarm recognizes this correlated_invocations_id and if it is a URI, can parse its query parameters for behavior control. One such control is ENSURE_OUTPUTS_PRESENT for the GetActionResult request - if this query value is the string “true”, BuildFarm will make a silent FindMissingBlobs check for all of the outputs of an ActionResult before responding with it. If any are missing, BuildFarm will instead return code NOT_FOUND, inspiring the client to see a cache miss, and attempt a [remote] execution.</p><hr><footer><p class="text-small text-grey-dk-100 mb-0"></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/bazelbuild/bazel-buildfarm/edit/main/_site/docs/execution/builds-without-the-bytes.md" id="edit-this-page">Edit on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
